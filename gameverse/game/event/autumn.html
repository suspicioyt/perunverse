<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Jesienne liście | Perun Gameverse</title>
    <link rel="icon" type="image/x-icon" href="https://suspicioyt.github.io/perunverse/logo/gameverse.png">
    <link rel="stylesheet" href="https://suspicioyt.github.io/perunverse/gameverse/style/public.cs">
    <style>
        body { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            background: linear-gradient(to bottom, #1a1a2e, #16213e); 
            color: #fff; 
            font-family: Arial, sans-serif; 
            overflow: hidden;
        }
        canvas { 
            border: 2px solid #4a4a4a; 
            background: linear-gradient(to bottom, #0f3460, #1a1a2e); 
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.3);
        }
        #ui { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            font-size: 20px; 
            z-index: 10;
        }
        #instructions { 
            position: absolute; 
            bottom: 10px; 
            left: 10px; 
            font-size: 12px; 
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div>Punkty: <span id="score">0</span></div>
        <div>Rekord: <span id="highScore">0</span></div>
    </div>
    <div id="instructions">
        Sterowanie: Strzałki / WASD | R - Restart
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script src="https://suspicioyt.github.io/perunverse/data/localData.js"></script>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');

        let score = 0;
        let highScore = Number(getLocalData('gameverse','autumn2025leaves')) || 0;
        highScoreDisplay.textContent = highScore;
        let gameOver = false;
        let gameSpeed = 1;

        // Koszyk gracza
        const basket = {
            x: canvas.width / 2 - 40,
            y: canvas.height - 60,
            width: 80,
            height: 40,
            speed: 6
        };

        // Obiekty (liście i jabłka)
        const objects = [];
        const leafImg = new Image();
        leafImg.src = 'https://img.icons8.com/color/48/000000/autumn.png';
        const appleImg = new Image();
        appleImg.src = 'https://img.icons8.com/color/48/000000/apple.png';

        // Ulepszony ruch liści
        function getLeafXOffset(time, baseX, windFactor) {
            // Większa amplituda i zmienna częstotliwość dla realizmu
            return Math.sin(time * 0.008 * windFactor + baseX * 0.02) * 30 * windFactor;
        }

        function getLeafYOffset(time, windFactor) {
            // Losowe wahania prędkości pionowej
            return Math.sin(time * 0.01 * windFactor) * 0.5;
        }

        function createObject() {
            const isLeaf = Math.random() > 0.4;
            const windFactor = 0.8 + Math.random() * 0.4; // Losowy wpływ wiatru
            const obj = {
                x: Math.random() * (canvas.width - 30),
                baseX: Math.random() * (canvas.width - 30), // Dla unikalnego ruchu
                y: -30,
                width: 30,
                height: 30,
                isLeaf: isLeaf,
                baseSpeed: 2 + Math.random() * 4 + gameSpeed * 0.5,
                rotation: Math.random() * Math.PI * 2, // Losowa początkowa rotacja
                rotationSpeed: (Math.random() - 0.5) * 0.1, // Zróżnicowana prędkość rotacji
                time: 0,
                windFactor: windFactor
            };
            objects.push(obj);
        }

        // Sterowanie koszykiem (strzałki + WASD)
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.key.toLowerCase() === 'r' && gameOver) {
                resetGame();
            }
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        function updateBasket() {
            if (keys['arrowleft'] || keys['a']) {
                basket.x = Math.max(0, basket.x - basket.speed);
            }
            if (keys['arrowright'] || keys['d']) {
                basket.x = Math.min(canvas.width - basket.width, basket.x + basket.speed);
            }
        }

        function resetGame() {
            score = 0;
            objects.length = 0;
            basket.x = canvas.width / 2 - 40;
            gameOver = false;
            gameSpeed = 1;
            update();
        }

        async function update() {
            if (gameOver) return;

            updateBasket();

            // Tworzenie nowych obiektów
            if (Math.random() < 0.025 + gameSpeed * 0.005) createObject();

            // Aktualizacja obiektów
            objects.forEach((obj, index) => {
                obj.time += 1;
                if (obj.isLeaf) {
                    // Realistyczny ruch liścia
                    obj.x = obj.baseX + getLeafXOffset(obj.time, obj.baseX, obj.windFactor);
                    obj.y += obj.baseSpeed + getLeafYOffset(obj.time, obj.windFactor);
                    obj.rotation += obj.rotationSpeed;
                } else {
                    // Jabłka spadają prosto
                    obj.y += obj.baseSpeed;
                    obj.rotation += 0.05;
                }

                // Kolizja z koszykiem
                if (obj.y + obj.height > basket.y && 
                    obj.y < basket.y + basket.height &&
                    obj.x + obj.width > basket.x && 
                    obj.x < basket.x + basket.width) {
                    if (obj.isLeaf) {
                        score += 1;
                        if (score > highScore) {
                            highScore = score;
                            setLocalData('gameverse', 'autumn2025leaves', highScore)
                            highScoreDisplay.textContent = highScore;
                        }
                    } else {
                        gameOver = true;
                    }
                    objects.splice(index, 1);
                    return;
                }

                // Usuwanie obiektów poza ekranem
                if (obj.y > canvas.height + 30) {
                    objects.splice(index, 1);
                }
            });

            // Zwiększanie trudności
            gameSpeed = 1 + Math.floor(score / 200);

            // Rysowanie tła
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0f3460');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Rysowanie obiektów z rotacją
            ctx.save();
            objects.forEach(obj => {
                ctx.translate(obj.x + obj.width/2, obj.y + obj.height/2);
                ctx.rotate(obj.rotation);
                ctx.drawImage(obj.isLeaf ? leafImg : appleImg, -obj.width/2, -obj.height/2, obj.width, obj.height);
                ctx.restore();
                ctx.save();
            });
            ctx.restore();

            // Rysowanie koszyka
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
            ctx.fillStyle = '#D2691E';
            ctx.fillRect(basket.x + 5, basket.y + 5, basket.width - 10, basket.height - 10);
            ctx.fillStyle = '#654321';
            ctx.fillRect(basket.x + basket.width/2 - 2, basket.y - 10, 4, 10);

            // Wyświetlanie punktów
            scoreDisplay.textContent = score;

            // Ekran końca gry
            if (gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FFD700';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Koniec gry!', canvas.width / 2, canvas.height / 2 - 50);
                ctx.font = '24px Arial';
                ctx.fillStyle = '#fff';
                ctx.fillText(`Punkty: ${score}`, canvas.width / 2, canvas.height / 2);
                ctx.fillText(`Rekord: ${highScore}`, canvas.width / 2, canvas.height / 2 + 30);
                ctx.fillText('Naciśnij R, aby zacząć od nowa', canvas.width / 2, canvas.height / 2 + 70);
            } else {
                requestAnimationFrame(update);
            }
        }

        // Start gry
        leafImg.onload = () => {
            appleImg.onload = () => {
                update();
            };
        };
    </script>
</body>
</html>